<div class="survey-builder">
  <div class="question-editor">
    <h3>Questions</h3>
    @for (q of questions; let i = index) {
    <div class="question-item">
      <span>{{ q.label }} ({{ q.type }})</span>
      <button type="button" (click)="moveUp(i)" [disabled]="i === 0">↑</button>
      <button type="button" (click)="moveDown(i)" [disabled]="i === questions.length - 1">↓</button>
      <button type="button" (click)="removeQuestion(i)">✕</button>
    </div>
    }
    <form [formGroup]="newQuestionForm" (ngSubmit)="addQuestion()" class="new-question">
      <label>
        Label
        <input formControlName="label" />
      </label>
      <label>
        Type
        <select formControlName="type">
          <option value="text">Text</option>
          <option value="textarea">Long Text</option>
          <option value="radio">Radio</option>
          <option value="checkbox">Checkbox</option>
          <option value="dropdown">Dropdown</option>
          <option value="date">Date</option>
          <option value="file">File</option>
          <option value="video">Video</option>
        </select>
      </label>
      <label>
        Required
        <input type="checkbox" formControlName="required" />
      </label>
      @if (['radio','checkbox','dropdown'].includes(newQuestionForm.value.type)) {
      <div formArrayName="options">
        @for (opt of options.controls; let j = index) {
        <div>
          <input [formControlName]="j" />
          <button type="button" (click)="removeOption(j)">Remove</button>
        </div>
        }
        <button type="button" (click)="addOption()">Add option</button>
      </div>
      }
      <button type="submit" [disabled]="newQuestionForm.invalid">Add Question</button>
    </form>
  </div>

  <div class="preview">
    <h3>Preview</h3>
    <form [formGroup]="previewForm">
      @for (q of questions) {
      <div class="preview-item">
        <label [attr.for]="'q' + q.id">{{ q.label }}</label>
        @switch (q.type) {
          @case ('text') {
            <input [formControlName]="'q' + q.id" type="text" [required]="q.required" />
          }
          @case ('textarea') {
            <textarea [formControlName]="'q' + q.id" [required]="q.required"></textarea>
          }
          @case ('dropdown') {
            <select [formControlName]="'q' + q.id" [required]="q.required">
              @for (o of q.options) {
              <option [value]="o">{{ o }}</option>
              }
            </select>
          }
          @case ('radio') {
            <div>
              @for (o of q.options) {
              <label>
                <input type="radio" [value]="o" [formControlName]="'q' + q.id" [required]="q.required" /> {{ o }}
              </label>
              }
            </div>
          }
          @case ('checkbox') {
            <div>
              @for (o of q.options; let cIndex = index) {
              <label>
                <input type="checkbox" [formControlName]="'q' + q.id" /> {{ o }}
              </label>
              }
            </div>
          }
          @case ('date') {
            <input type="date" [formControlName]="'q' + q.id" [required]="q.required" />
          }
          @case ('file') {
            <input type="file" [formControlName]="'q' + q.id" [required]="q.required" />
          }
          @case ('video') {
            <input type="url" [formControlName]="'q' + q.id" [required]="q.required" placeholder="Video URL" />
          }
        }
      </div>
      }
    </form>
  </div>
</div>
